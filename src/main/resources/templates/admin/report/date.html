<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>

    <th:block th:replace="/admin/layout/head :: head"/>
    <meta charset="UTF-8">
    <title>Báo Cáo Ngày</title>
</head>

<body>


<!-- Page Wrapper -->
<div id="main-wrapper" data-layout="vertical" data-navbarbg="skin5" data-sidebartype="full"
     data-sidebar-position="absolute" data-header-position="absolute" data-boxed-layout="full">
    <th:block th:replace="/admin/layout/navBar :: navBar"/>

    <div class="row">
        <div class="col-xs-10 ">
            <div class="normal-table-list mg-t-30">
                <div class="basic-tb-hd text-center">
                    <h1>Báo Cáo Ngày</h1>
                    <h6 class="fw-light">Ngày Bán :
                        <input id="dateReport" type="date" value="" min="01-10-2011" max="31-12-2042" placeholder="dd-mm-yyyy"/>
                    </h6>

                </div>
                <div class="bsc-tbl-hvr table-responsive ">
                    <table class="table table-hover table-striped" id="tblReport">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Thời gian</th>
                            <th>Nhân Viên</th>
                            <th>Số Lượng</th>
                            <th>Doanh thu</th>
                        </tr>
                        </thead>
                        <tfoot >
                        <tr>
                            <th colspan="4" class="fw-bold" style="text-align:right">Tổng Doanh Thu :</th>
                            <th style="text-align:right"></th>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <th:block th:replace="/admin/layout/footer :: footer"/>
</div>
<th:block th:replace="/admin/layout/script :: script"/>
</body>
<script>
    let dateReport = new Date();
    let day = dateReport.getDate();
    let month= (dateReport.getMonth())+1;
    let year=dateReport.getFullYear();
    $("#dateReport").val(`${year}-${month}-${day<10 ? `0${day}`:`${day}`}`)

    let getDate = moment($("#dateReport").val()).format('DD-MM-yyyy')
    console.log(getDate)
    renderDataTableReport();

    function renderDataTableReport() {
        $('#tblReport').dataTable({
            ajax: {
                contentType: 'application/json',
                url: `http://localhost:8080/api/order?createAt=${getDate}`,
                type: 'GET',

                dataSrc: ''
            },
            searching: false,
            columns: [
                {
                    data: "id", render: function (id) {

                        return `<td>${"O-" + id}</td>`
                    }
                },
                {
                    data: "createAt", render: function (createAt) {
                        return `<td>${moment(createAt).format('h:mm:ss a')}</td>`

                    }
                },
                {data: "userId"},
                {
                    data: "totalQuantity"
                },
                {
                    data: "grandTotal", render: function (grandTotal) {
                        return new Intl.NumberFormat('vi-VN', {
                            style: 'currency',
                            currency: 'VND'
                        }).format(grandTotal)
                    }
                }

            ],
            columnDefs: [
                {
                    targets: 3,
                    className: "text-right"
                },
                {
                    targets: -1,
                    className: "text-right"
                }
            ],
            footerCallback:function (row, data, start, end, display){
                var api = this.api();

                // Remove the formatting to get integer data for summation
                var intVal = function (i) {
                    return typeof i === 'string' ? i.replace(/[\$,]/g, '') * 1 : typeof i === 'number' ? i : 0;
                };
                total = api
                    .column(4)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                pageTotal = api
                    .column(4, { page: 'current' })
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                $(api.column(4).footer()).html(new Intl.NumberFormat('vi-VN', {
                        style: 'currency',
                        currency: 'VND'
                    }).format(pageTotal)  );
            }

        })

    }
$("#dateReport").on('input', function (){
    let newDate = moment($("#dateReport").val()).format('DD-MM-yyyy');
    $('#tblReport').DataTable().ajax.url(`http://localhost:8080/api/order?createAt=${newDate}`).load().draw()
})

</script>

</html>